@model debt_fe.Models.ViewModels.AuthenticationViewModel
@{
    ViewBag.Title = "AuthenticationSMS";
    Layout = "~/Views/Shared/_LayoutLogin.cshtml";
}
<link href="~/Content/toastr.min.css" rel="stylesheet" />
<style>
    h4 {
        font-weight: 600;
    }

    .btn-sendsms {
        background: none !important;
        border: none;
        padding: 0 !important;
        font: inherit;
        color: #2b7dff;
        /*border is optional*/
        cursor: pointer;
    }

    .disabled {
        color: gray;
    }
</style>
<div class="row">
    <div class="col-md-6 col-md-offset-3">
        <div class="row">
            <a href="#" class="text-center display-block p++">
                <img src='@Url.Content("~/Content/images/logo.png")' />
            </a>
            @using (Html.BeginForm("AuthenticationSMS", "Account", FormMethod.Post, htmlAttributes: new { @class = "form-horizontal m0 pb0", id = "form-login" }))
            {
                <div class="row">
                    <div class="col-md-offset-3 col-md-6">
                        <h4 class="text-center text-bold">Multi-Factor Authentication</h4>
                        <hr />
                    </div>
                </div>

                @Html.HiddenFor(model=>model.NumberPhone)
                <div class="row">
                    <div class="col-sm-3">
                        <img class="img-responsive pull-right" style="width : 30px;" src="~/Content/images/icon-tfa.png" />
                    </div>
                    <div class="col-sm-6">
                        Enter verification code generated by your phone ending in - @Model.HideNumber
                    </div>
                </div>
                <div class="row text-center">
                    <h4 class="login-error-summary">@Html.ValidationSummary()</h4>
                </div>
                <div class="row center-block">
                    <div class="col-xs-6  form-group " style="margin-left: 25%!important;">
                        <label class="control-label text-bold">Step 2: Enter verification code</label>
                        <div>
                            @Html.TextBoxFor(m => m.SMSCode, htmlAttributes: new { @class = "form-control no-border-radius", placeholder = "Enter code here" })
                        </div>
                    </div>
                </div>


                <div class="form-group text-center">
                    <div class="col-xs-6 col-xs-offset-3">
                        <button type="submit" class="btn btn-primary mb">VERIFY</button>
                        <div><button type="button" data-href="@Url.Action("SendSMSAgain", "Account", new { numberPhone = Model.NumberPhone })" class="disabled btn btn-sendsms ">Code not working? </button> (<span id="time-down">30</span>s)</div>
                    </div>
                </div>
            }
        </div>
    </div>

</div>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/Scripts/jquery.countdown.js"></script>
    <script src="~/Scripts/toastr.min.js"></script>
    <script src="~/Scripts/plugins/toastr.js"></script>
    <script>
        $("input").focus();
        var fiveSeconds = new Date().getTime() + 30000;
        $('#time-down').countdown(fiveSeconds)
            .on('update.countdown', function (event) {
                var $this = $(this);
                $this.html(event.strftime('%S'));
            }).on('finish.countdown', function (event) {
                var $this = $(this);
                $this.html("0")
                $(".btn-sendsms").removeClass('disabled');
            });



        $(".btn-sendsms").click(function () {
            var $this = $(this);
            var href = $this.attr("data-href");
            $.get(href, function (data) {
                if (data.code > 0)
                    toastr.success(data.msg, "Send SMS");
                if (data.code == -1)
                    toastr.error(data.msg, "Send SMS");
                if (data.code == -2) {
                    window.location = "@Url.Action("Login","Account")";
                }

            }, "json");
            $this.addClass("disabled");
            $("#SMSCode").focus();
            fiveSeconds = new Date().getTime() + 30000;
            $('#time-down').countdown(fiveSeconds)
            .on('update.countdown', function (event) {
                var $this = $(this);
                $this.html(event.strftime('%S'));
            }).on('finish.countdown', function (event) {
                var $this = $(this);
                $this.html("0")
                $(".btn-sendsms").removeClass('disabled');
            });
        });
    </script>
}

